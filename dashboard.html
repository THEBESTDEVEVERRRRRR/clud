<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CloudCompute Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js" type="module"></script>
    <style>
      .input {
        width: 100%;
        padding: 16px 18px;
        border: 1.5px solid #d1d5db;
        border-radius: 16px;
        font-size: 1.1rem;
        margin-bottom: 1.2rem;
        background: #f9fafb;
        transition: border 0.2s;
      }
      .input:focus {
        outline: none;
        border: 1.5px solid #007bff;
        background: #fff;
      }
    </style>
    <script type="module">
        import { app, auth, db } from './script.js';
        import { ref, onValue } from 'https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js';
        import { onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js';

        // Use the imported db instance

        // Handle sign out
        document.getElementById('sign-in').addEventListener('click', (e) => {
            e.preventDefault();
            signOut(auth).then(() => {
                window.location.href = 'sign-in.html';
            });
        });

        // Check authentication state
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'sign-in.html';
                return;
            }

            // Get user's orders
            const ordersRef = ref(db, 'orders');
            onValue(ordersRef, (snapshot) => {
                const data = snapshot.val();
                let activeServers = 0;
                let totalSpend = 0;

                if (data) {
                    Object.values(data).forEach(order => {
                        if (order.userId === user.uid) {
                            activeServers++;
                            // Check both amount and price fields for backwards compatibility
                            const orderAmount = order.amount || order.price || 0;
                            totalSpend += parseFloat(orderAmount);
                        }
                    });
                }

                // Update dashboard values
                document.getElementById('active-servers').textContent = activeServers;
                document.getElementById('total-spend').textContent = `$${totalSpend.toFixed(2)}`;
            });
        });
    </script>
</head>
<body>
    <!-- Header/Navigation -->
    <header class="header">
        <nav class="nav container">
            <div class="nav-brand">
                <a href="/">
                    <img src="clud.png" alt="Clud Logo" class="logo" style="height:48px; width:auto;" />
                </a>
            </div>
            <div class="nav-menu" id="nav-menu">
                <ul class="nav-list">
                    <li class="nav-item"><a href="index.html#features" class="nav-link">Features</a></li>
                    <li class="nav-item"><a href="index.html#testimonials" class="nav-link">Testimonials</a></li>
                    <li class="nav-item"><a href="pricing.html" class="nav-link">Pricing</a></li>
                    <li class="nav-item"><a href="index.html#contact" class="nav-link">Contact</a></li>
                </ul>
            </div>
            <div class="nav-actions">
                <a href="sign-in.html" class="btn btn-outline" id="sign-in">Sign Out</a>
            </div>
            <div class="nav-toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <!-- Dashboard Main Content -->
    <section class="dashboard-section">
        <div class="container" style="margin-top:3rem;">
            <h2 class="section-title" style="margin-bottom:2rem;">Welcome to Your Dashboard</h2>
            <div class="dashboard-cards" style="display:flex;gap:2rem;flex-wrap:wrap;">
                <div class="card" style="flex:1;min-width:260px;box-shadow:var(--shadow-md);border-radius:var(--radius-md);padding:2rem;background:#fff;">
                    <h3 class="card-title">Active Servers</h3>
                    <p class="card-value" style="font-size:2rem;font-weight:700;" id="active-servers">0</p>
                    <p class="card-desc">Currently running cloud servers</p>
                </div>
                <div class="card" style="flex:1;min-width:260px;box-shadow:var(--shadow-md);border-radius:var(--radius-md);padding:2rem;background:#fff;">
                    <h3 class="card-title">Usage This Month</h3>
                    <p class="card-value" style="font-size:2rem;font-weight:700;" id="total-spend">$0.00</p>
                    <p class="card-desc">Total spend for September</p>
                </div>
                <div class="card" style="flex:1;min-width:260px;box-shadow:var(--shadow-md);border-radius:var(--radius-md);padding:2rem;background:#fff;">
                    <h3 class="card-title">Support Tickets</h3>
                    <p class="card-value" style="font-size:2rem;font-weight:700;">1</p>
                    <p class="card-desc">Open support requests</p>
                </div>
            </div>
            <div style="margin-top:3rem;">
                <h3 class="section-title" style="margin-bottom:1rem;">Quick Actions</h3>
                <div style="display:flex;gap:1rem;flex-wrap:wrap;">
                    <a href="pricing.html" class="btn btn-primary">Deploy New Server</a>
                    <a href="usage.html" class="btn btn-outline">View Usage</a>
                    <a href="#" class="btn btn-outline">Contact Support</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer" style="margin-top:4rem;">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3 class="footer-logo">CloudCompute Pro</h3>
                    <p class="footer-tagline">Enterprise-grade compute infrastructure for modern applications</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p class="copyright">Â© 2025 CloudCompute Pro. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
      import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
      const firebaseConfig = {
      apiKey: "AIzaSyA-E-8tOgugt5gZkVDYT4XnQdzY9XhRKaw",
      authDomain: "clud-d5315.firebaseapp.com",
      projectId: "clud-d5315",
      storageBucket: "clud-d5315.firebasestorage.app",
      messagingSenderId: "953090765245",
      appId: "1:953090765245:web:008cfc0572335df5f122d4"
      };
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      // Redirect to index.html if not logged in
      onAuthStateChanged(auth, (user) => {
        if (!user) {
          window.location.href = "index.html";
        }
      });
      // Sign out button
      document.getElementById("sign-in")?.addEventListener("click", function(e) {
        e.preventDefault();
        signOut(auth).then(() => {
          window.location.href = "index.html";
        });
      });
    </script>
</body>
</html>
